# Dockerfile for the prow test environment

# We'd use the kubekins-e2e straight away, but it's missing the 'kind' binary.
ARG KUBEKINS="v20200408-52013df6-1.14"


FROM golang:1.14.2-alpine AS build-base
RUN apk add bash ca-certificates coreutils git gcc g++ libc-dev unzip

# We don't use or support modules for the time being.
ENV GO111MODULE=off
# Build static binaries only.
ENV CGO_ENABLED=0

# kind can run kubernetes clusters in docker
# v0.2.1
ARG KIND_RELEASE="v0.7.0"
ARG KIND_REPO="sigs.k8s.io/kind"
RUN go get -d -u ${KIND_REPO}
WORKDIR /go/src/${KIND_REPO}
RUN git checkout ${KIND_RELEASE} && go install ${KIND_REPO}

ARG KUBEKINS
FROM gcr.io/gke-test-infra/kubekins-e2e:${KUBEKINS}
COPY --from=build-base /go/bin/ /bin/
