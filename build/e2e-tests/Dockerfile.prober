# e2e-prober is the same as e2e-base, except it hard-codes the test environment
# instead of mounting it in.
FROM gcr.io/stolos-dev/e2e-tests:test-e2e-latest

# Requires that the files have already been staged here.
COPY .output/e2e /opt/testing/e2e

RUN mkdir -p /tmp/home/user

# This is where gcloud and kubectl will store their configuration.
ENV HOME /tmp/home/user
ENV USER prober
ENV PATH /opt/gcloud/google-cloud-sdk/bin:$PATH

ENTRYPOINT [ \
  "/opt/testing/e2e/setup.sh", \
  "--gcp-prober-cred", "/etc/prober-gcp-service-account/prober_runner_client_key.json", \
  "--gcp-runner-cred", "gs://stolos-dev/e2e/nomos-e2e.joonix.net/test_runner_client_key.json", \
  "--gcp-watcher-cred", "gs://stolos-dev/e2e/nomos-e2e.joonix.net/watcher_client_key.json", \
  "--importer", "gcp", \
  "--skip-installation", \
  "--tap", \
  "--test" \
]
